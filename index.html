<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EZDAN≈ûER ULTIMATE | FIREBASE v2.0</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@400;900&family=Inter:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <!-- FIREBASE K√úT√úPHANELERƒ∞ -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        :root {
            --bg-deep: #030005;
            --bg-dark: #0a0112;
            --card-bg: rgba(15, 2, 28, 0.95);
            --accent: #a855f7;
            --accent-bright: #d8b4fe;
            --accent-glow: rgba(168, 85, 247, 0.5);
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --danger: #ff4757;
            --success: #2ed573;
            --warning: #ffa502;
            --border-style: 1px solid rgba(168, 85, 247, 0.25);
            --panel-shadow: 0 0 40px rgba(0, 0, 0, 0.8), 0 0 20px var(--accent-glow);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }

        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        #matrix-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0.4;
        }

        .scanline {
            width: 100%;
            height: 100px;
            z-index: 2;
            background: linear-gradient(0deg, rgba(0, 0, 0, 0) 0%, rgba(168, 85, 247, 0.05) 50%, rgba(0, 0, 0, 0) 100%);
            opacity: 0.1;
            position: absolute;
            bottom: 100%;
            animation: scanline 8s linear infinite;
            pointer-events: none;
        }

        @keyframes scanline {
            0% { bottom: 100%; }
            100% { bottom: -100px; }
        }

        #auth-overlay {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            background: radial-gradient(circle at center, transparent, var(--bg-deep));
            transition: opacity 0.8s ease, transform 0.8s ease;
        }

        .auth-card {
            width: 480px;
            padding: 60px;
            background: var(--card-bg);
            border-radius: 40px;
            border: var(--border-style);
            box-shadow: var(--panel-shadow);
            backdrop-filter: blur(25px);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .auth-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, transparent, transparent, var(--accent));
            animation: rotate-border 6s linear infinite;
            z-index: -1;
        }

        @keyframes rotate-border {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .auth-card h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            letter-spacing: 12px;
            margin-bottom: 10px;
            color: var(--accent);
            text-shadow: 0 0 20px var(--accent-glow);
        }

        .auth-card p {
            color: var(--text-dim);
            font-size: 0.9rem;
            margin-bottom: 40px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 8px;
            color: var(--accent);
            font-weight: 700;
        }

        .ez-input {
            width: 100%;
            padding: 18px 24px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(168, 85, 247, 0.1);
            border-radius: 16px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .ez-input:focus {
            background: rgba(168, 85, 247, 0.08);
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(168, 85, 247, 0.2);
        }

        .auth-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 25px 0;
            font-size: 0.85rem;
            color: var(--text-dim);
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            cursor: pointer;
            gap: 10px;
        }

        .checkbox-container input {
            accent-color: var(--accent);
            width: 18px;
            height: 18px;
        }

        .btn-glow {
            width: 100%;
            padding: 20px;
            border: none;
            border-radius: 16px;
            background: linear-gradient(45deg, var(--accent), #6d28d9);
            color: white;
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 10px 30px -10px var(--accent);
            transition: 0.4s;
            position: relative;
            overflow: hidden;
        }

        .btn-glow:hover {
            transform: translateY(-3px);
            filter: brightness(1.2);
            box-shadow: 0 15px 40px -10px var(--accent);
        }

        .auth-switch {
            margin-top: 25px;
            font-size: 0.8rem;
            color: var(--text-dim);
        }

        .auth-switch span {
            color: var(--accent);
            cursor: pointer;
            font-weight: 700;
        }

        #main-dashboard {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 50;
            background: var(--bg-deep);
            flex-direction: column;
        }

        .topbar {
            height: 80px;
            background: rgba(10, 1, 18, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: var(--border-style);
            padding: 0 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .brand-logo {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 1.5rem;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: var(--success);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.4; }
            100% { opacity: 1; }
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 8px 15px;
            border-radius: 100px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .avatar-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--accent), #4f46e5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: white;
            font-size: 0.9rem;
            border: 2px solid var(--accent);
        }

        .dashboard-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            background: rgba(10, 1, 18, 0.5);
            border-right: var(--border-style);
            padding: 30px 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .nav-link {
            padding: 16px 20px;
            border-radius: 16px;
            color: var(--text-dim);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 600;
            transition: 0.3s;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .nav-link:hover {
            background: rgba(168, 85, 247, 0.05);
            color: white;
            padding-left: 25px;
        }

        .nav-link.active {
            background: rgba(168, 85, 247, 0.15);
            color: white;
            border-color: var(--accent);
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.1);
        }

        .admin-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .section-label {
            font-size: 0.65rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
            margin-left: 20px;
            font-weight: 900;
        }

        .main-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            position: relative;
        }

        .grid-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--card-bg);
            border: var(--border-style);
            border-radius: 24px;
            padding: 30px;
            position: relative;
            overflow: hidden;
            transition: 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            background: rgba(15, 2, 28, 1);
        }

        .stat-card h3 {
            font-size: 0.8rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--accent);
        }

        .stat-card .trend {
            font-size: 0.75rem;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .trend.up { color: var(--success); }
        .trend.down { color: var(--danger); }

        .glass-panel {
            background: var(--card-bg);
            border: var(--border-style);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .ez-table {
            width: 100%;
            border-collapse: collapse;
            text-align: left;
        }

        .ez-table th {
            padding: 15px;
            font-size: 0.75rem;
            color: var(--accent);
            text-transform: uppercase;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .ez-table td {
            padding: 18px 15px;
            font-size: 0.9rem;
            color: var(--text-main);
            border-bottom: 1px solid rgba(255, 255, 255, 0.02);
        }

        .badge {
            padding: 5px 12px;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .badge-admin { background: rgba(168, 85, 247, 0.2); color: var(--accent); border: 1px solid var(--accent); }
        .badge-user { background: rgba(148, 163, 184, 0.1); color: var(--text-dim); }

        #notif-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .notif {
            width: 350px;
            padding: 20px;
            background: rgba(15, 2, 28, 0.9);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            border-left: 5px solid var(--accent);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: slideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 40px;
        }

        .profile-card {
            text-align: center;
        }

        .profile-avatar-big {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 20px;
            border: 4px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            background: var(--bg-dark);
            box-shadow: 0 0 30px var(--accent-glow);
        }

        .btn-action {
            padding: 10px 20px;
            border-radius: 10px;
            border: 1px solid var(--accent);
            background: transparent;
            color: white;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-action:hover {
            background: var(--accent);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .password-text {
            font-family: 'JetBrains Mono', monospace;
            color: var(--warning);
            font-weight: 700;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 5px;
            background: rgba(255, 165, 2, 0.1);
        }

        .password-text:hover {
            background: rgba(255, 165, 2, 0.2);
        }

        @media (max-width: 1000px) {
            .sidebar { width: 80px; }
            .nav-link span, .section-label { display: none; }
            .sidebar { padding: 30px 10px; }
        }
    </style>
</head>
<body oncontextmenu="return false;">

    <canvas id="matrix-canvas"></canvas>
    <div class="scanline"></div>

    <div id="auth-overlay">
        <div class="auth-card">
            <h1 id="auth-title">CORE</h1>
            <p id="auth-desc">L√ºtfen Quantum sistemine kimlik doƒürulamasƒ± yapƒ±n.</p>

            <div id="login-form">
                <div class="form-group">
                    <label>E-posta Adresi</label>
                    <input type="email" id="auth-email" class="ez-input" placeholder="isim@domain.com">
                </div>
                <div class="form-group">
                    <label>Eri≈üim ≈ûifresi</label>
                    <input type="password" id="auth-pass" class="ez-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>

                <div id="register-fields" style="display: none;">
                    <div class="form-group">
                        <label>Sistem Kullanƒ±cƒ± Adƒ±</label>
                        <input type="text" id="auth-nick" class="ez-input" placeholder="Ezdan≈üer_PRO">
                    </div>
                </div>

                <div class="auth-actions">
                    <label class="checkbox-container">
                        <input type="checkbox" id="show-password">
                        <span>≈ûifreyi G√∂ster</span>
                    </label>
                    <label class="checkbox-container">
                        <input type="checkbox" id="remember-me">
                        <span>Oturumu Koru</span>
                    </label>
                </div>

                <button class="btn-glow" id="btn-submit" onclick="executeAuth()">Sƒ∞STEME SIZ</button>

                <div id="auth-error" style="color: var(--danger); font-size: 0.8rem; font-weight: 700; margin-top: 15px; min-height: 20px;"></div>

                <div class="auth-switch">
                    Hen√ºz bir kaydƒ±n yok mu? <span onclick="toggleAuthMode()" id="switch-text">Yeni Hesap Olu≈ütur</span>
                </div>
            </div>
        </div>
    </div>

    <div id="main-dashboard">
        <div class="topbar">
            <div class="brand-logo">
                <div class="status-dot"></div>
                EZDAN≈ûER <span style="font-weight: 300; font-size: 0.8rem; color: white;">FIREBASE v2.0</span>
            </div>

            <div style="display: flex; gap: 30px; align-items: center;">
                <div id="server-time" style="font-family: 'JetBrains Mono'; font-size: 0.9rem; color: var(--accent);">00:00:00</div>
                <div class="user-profile">
                    <div style="text-align: right;">
                        <div id="top-user-name" style="font-weight: 900; font-size: 0.85rem;">Admin</div>
                        <div id="top-user-role" style="font-size: 0.65rem; color: var(--accent); letter-spacing: 1px;">SUPREME ADMIN</div>
                    </div>
                    <div class="avatar-circle" id="top-avatar">A</div>
                </div>
            </div>
        </div>

        <div class="dashboard-body">
            <div class="sidebar">
                <div class="section-label">Main Console</div>
                <div class="nav-link active" onclick="switchTab('home', this)">üè† <span>Dashboard</span></div>
                <div class="nav-item nav-link" onclick="switchTab('software', this)">üéØ <span>Yazƒ±lƒ±m Havuzu</span></div>
                <div class="nav-item nav-link" onclick="switchTab('settings', this)">‚öôÔ∏è <span>Profil Ayarlarƒ±</span></div>

                <div id="admin-sidebar" style="display: none;">
                    <div class="admin-section">
                        <div class="section-label">Admin Control</div>
                        <div class="nav-link" onclick="switchTab('users', this)">üõ°Ô∏è <span>Kullanƒ±cƒ± Y√∂netimi</span></div>
                        <div class="nav-link" onclick="switchTab('logs', this)">üìú <span>Sistem Loglarƒ±</span></div>
                    </div>
                </div>

                <div style="margin-top: auto;">
                    <div class="nav-link" style="color: var(--danger);" onclick="systemLogout()">üö™ <span>Baƒülantƒ±yƒ± Kes</span></div>
                </div>
            </div>

            <div class="main-content" id="content-area">
                <!-- ƒ∞√ßerik buraya y√ºklenecek -->
            </div>
        </div>
    </div>

    <div id="notif-container"></div>

    <script>
        // ============================================
        // EZDAN≈ûER ULTIMATE - FIREBASE EDITION
        // ADMIN ≈ûƒ∞FRELERƒ∞ G√ñREBƒ∞Lƒ∞R!
        // ============================================
        
        // --- FIREBASE CONFIG (SENƒ∞N Bƒ∞LGƒ∞LERƒ∞N) ---
        const firebaseConfig = {
            apiKey: "AIzaSyDeLMAKuprzkCT87w_kArdRw0aEQEv_KE",
            authDomain: "ezdanser-v15.firebaseapp.com",
            databaseURL: "https://ezdanser-v15-default-rtdb.firebaseio.com",
            projectId: "ezdanser-v15",
            storageBucket: "ezdanser-v15.firebasestorage.app",
            messagingSenderId: "315185864990",
            appId: "1:315185864990:web:4e8421a51d92caba4e90f"
        };

        // Firebase'i ba≈ülat
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // --- GLOBAL DEƒûƒ∞≈ûKENLER ---
        let currentUser = null;
        let authMode = "login";
        let db = [];
        let systemLogs = [];

        // ============================================
        // FIREBASE VERƒ∞TABANI ƒ∞≈ûLEMLERƒ∞
        // ============================================
        
        // Kullanƒ±cƒ±larƒ± Firebase'den y√ºkle
        function loadUsers() {
            return new Promise((resolve) => {
                database.ref('users').once('value', (snapshot) => {
                    const users = snapshot.val();
                    db = [];
                    if (users) {
                        Object.keys(users).forEach(key => {
                            db.push(users[key]);
                        });
                    }
                    resolve(db);
                });
            });
        }
        
        // Kullanƒ±cƒ± ekle Firebase'e
        function addUserToFirebase(user) {
            return database.ref('users/' + user.id).set(user);
        }
        
        // Loglarƒ± Firebase'den y√ºkle
        function loadLogs() {
            return new Promise((resolve) => {
                database.ref('logs').once('value', (snapshot) => {
                    const logs = snapshot.val();
                    systemLogs = [];
                    if (logs) {
                        Object.keys(logs).forEach(key => {
                            systemLogs.push(logs[key]);
                        });
                        systemLogs.sort((a, b) => new Date(b.date) - new Date(a.date));
                    }
                    resolve(systemLogs);
                });
            });
        }
        
        // Log ekle Firebase'e
        function addLogToFirebase(log) {
            const logId = 'log-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            return database.ref('logs/' + logId).set(log);
        }

        // ============================================
        // BA≈ûLANGI√á
        // ============================================
        window.onload = async function() {
            initMatrix();
            startClocks();
            
            try {
                await loadUsers();
                await loadLogs();
                console.log("Firebase baƒülantƒ±sƒ± ba≈üarƒ±lƒ±!");
            } catch(e) {
                console.log("Firebase baƒülantƒ± hatasƒ±:", e);
            }
            
            checkAutoLogin();
            
            const showPassCheckbox = document.getElementById("show-password");
            if (showPassCheckbox) {
                showPassCheckbox.addEventListener('change', function() {
                    const passInput = document.getElementById("auth-pass");
                    if (passInput) {
                        passInput.type = this.checked ? "text" : "password";
                    }
                });
            }
        };

        // --- MATRIX ARKAPLAN ---
        function initMatrix() {
            const canvas = document.getElementById("matrix-canvas");
            if (!canvas) return;
            
            const ctx = canvas.getContext("2d");
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const letters = "EZDAN≈ûER101011001";
            const fontSize = 16;
            const columns = canvas.width / fontSize;
            const drops = Array(Math.floor(columns)).fill(1);

            function draw() {
                ctx.fillStyle = "rgba(3, 0, 5, 0.1)";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = "#a855f7";
                ctx.font = fontSize + "px 'JetBrains Mono'";
                for (let i = 0; i < drops.length; i++) {
                    const text = letters[Math.floor(Math.random() * letters.length)];
                    ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                        drops[i] = 0;
                    }
                    drops[i]++;
                }
            }
            setInterval(draw, 33);
        }

        // --- SAAT ---
        function startClocks() {
            setInterval(() => {
                const now = new Date();
                const clock = document.getElementById("server-time");
                if(clock) clock.innerText = now.toLocaleTimeString('tr-TR');
            }, 1000);
        }

        // ============================================
        // Gƒ∞Rƒ∞≈û / KAYIT Sƒ∞STEMƒ∞
        // ============================================
        
        function toggleAuthMode() {
            const regFields = document.getElementById("register-fields");
            const title = document.getElementById("auth-title");
            const switchText = document.getElementById("switch-text");
            const btnSubmit = document.getElementById("btn-submit");
            const error = document.getElementById("auth-error");
            
            error.innerText = "";
            
            if(authMode === "login") {
                authMode = "register";
                regFields.style.display = "block";
                title.innerText = "SIGNUP";
                switchText.innerText = "Giri≈ü Yap";
                btnSubmit.innerText = "HESAP OLU≈ûTUR";
            } else {
                authMode = "login";
                regFields.style.display = "none";
                title.innerText = "CORE";
                switchText.innerText = "Yeni Hesap Olu≈ütur";
                btnSubmit.innerText = "Sƒ∞STEME SIZ";
            }
        }

        function validateEmailStrict(email) {
            const regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.(com|net|org|com\.tr|edu|gov)$/i;
            return regex.test(String(email).toLowerCase());
        }

        async function executeAuth() {
            const email = document.getElementById("auth-email").value;
            const pass = document.getElementById("auth-pass").value;
            const nick = document.getElementById("auth-nick").value;
            const error = document.getElementById("auth-error");
            const remember = document.getElementById("remember-me").checked;

            if(!validateEmailStrict(email)) {
                error.innerText = "HATA: Ge√ßerli bir e-posta girin! (.com, .net, .org)";
                return;
            }

            if(pass.length < 6) {
                error.innerText = "HATA: ≈ûifre en az 6 karakter olmalƒ±dƒ±r!";
                return;
            }

            await loadUsers();

            if(authMode === "register") {
                if(db.find(u => u.email === email)) {
                    error.innerText = "HATA: Bu e-posta zaten kullanƒ±mda!";
                    return;
                }
                
                const newUser = {
                    id: 'UID-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5),
                    email: email,
                    pass: pass, 
                    nick: nick || "User_" + Math.floor(Math.random() * 999),
                    role: "user",
                    joinDate: new Date().toLocaleDateString('tr-TR'),
                    lastLogin: new Date().toLocaleString('tr-TR')
                };
                
                await addUserToFirebase(newUser);
                db.push(newUser);
                await addLog("Yeni kayƒ±t: " + email, newUser);
                
                pushNotification("Sistem", "Kayƒ±t ba≈üarƒ±lƒ±! ≈ûimdi giri≈ü yapabilirsiniz.");
                toggleAuthMode();
            } else {
                let user = null;
                if(email === "admin@admin.com" && pass === "admin123") {
                    user = { 
                        nick: "Kurucu Admin", 
                        role: "admin", 
                        email: "admin@admin.com", 
                        avatar: "K",
                        id: "ADMIN-001"
                    };
                } else {
                    user = db.find(u => u.email === email && u.pass === pass);
                }

                if(user) {
                    currentUser = user;
                    await addLog("Sisteme giri≈ü yaptƒ±", user);
                    
                    if(remember) {
                        localStorage.setItem("ez_v15_session", JSON.stringify(user));
                    }
                    
                    launchDashboard();
                } else {
                    error.innerText = "HATA: E-posta veya ≈üifre hatalƒ±!";
                }
            }
        }

        // ============================================
        // LOG Sƒ∞STEMƒ∞
        // ============================================
        async function addLog(action, user) {
            const log = {
                id: 'log-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5),
                user: user.nick,
                role: user.role,
                action: action,
                date: new Date().toLocaleString('tr-TR')
            };
            
            await addLogToFirebase(log);
            
            systemLogs.unshift(log);
            if (systemLogs.length > 50) {
                systemLogs = systemLogs.slice(0, 50);
            }
        }

        // ============================================
        // DASHBOARD ƒ∞≈ûLEMLERƒ∞
        // ============================================
        
        async function checkAutoLogin() {
            const session = localStorage.getItem("ez_v15_session");
            if(session) {
                try {
                    currentUser = JSON.parse(session);
                    await loadUsers();
                    await loadLogs();
                    launchDashboard();
                } catch(e) {
                    console.log("Oturum hatasƒ±");
                }
            }
        }

        function launchDashboard() {
            const authOverlay = document.getElementById("auth-overlay");
            authOverlay.style.opacity = "0";
            
            setTimeout(() => {
                authOverlay.style.display = "none";
                document.getElementById("main-dashboard").style.display = "flex";
                
                document.getElementById("top-user-name").innerText = currentUser.nick;
                document.getElementById("top-user-role").innerText = currentUser.role === "admin" ? "SUPREME ADMIN" : "AUTHORIZED MEMBER";
                document.getElementById("top-avatar").innerText = currentUser.nick.charAt(0).toUpperCase();

                const adminSidebar = document.getElementById("admin-sidebar");
                if(currentUser.role === "admin") {
                    adminSidebar.style.display = "block";
                } else {
                    adminSidebar.style.display = "none";
                }

                switchTab('home');
                pushNotification("Quantum OS", `Ho≈ü geldin, ${currentUser.nick}. Eri≈üim saƒülandƒ±.`);
            }, 800);
        }

        async function refreshUsers() {
            await loadUsers();
            switchTab('users');
            pushNotification("Admin", `Kullanƒ±cƒ± listesi g√ºncellendi (${db.length} kullanƒ±cƒ±)`);
        }

        // ============================================
        // ≈ûƒ∞FRE G√ñSTERME FONKSƒ∞YONLARI (SADECE ADMIN)
        // ============================================
        
        function togglePassword(element, password) {
            if (element.innerText === '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢') {
                element.innerText = password;
                element.style.color = '#ff4757';
                pushNotification('Admin', '≈ûifre g√∂steriliyor');
            } else {
                element.innerText = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                element.style.color = '#ffa502';
                pushNotification('Admin', '≈ûifre gizlendi');
            }
        }

        function showAllPasswords() {
            document.querySelectorAll('.password-text').forEach(el => {
                const pass = el.getAttribute('data-password');
                if (pass) {
                    el.innerText = pass;
                    el.style.color = '#ff4757';
                }
            });
            pushNotification('Admin', 'T√ºm ≈üifreler g√∂steriliyor');
        }

        function hideAllPasswords() {
            document.querySelectorAll('.password-text').forEach(el => {
                el.innerText = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                el.style.color = '#ffa502';
            });
            pushNotification('Admin', 'T√ºm ≈üifreler gizlendi');
        }

        async function switchTab(tab, element = null) {
            const area = document.getElementById("content-area");
            if (!area) return;

            if(element) {
                document.querySelectorAll(".nav-link").forEach(l => l.classList.remove("active"));
                element.classList.add("active");
            }

            await loadUsers();
            await loadLogs();

            let html = "";

            if(tab === 'home') {
                html = `
                    <h1 style="font-family: 'Orbitron'; margin-bottom: 30px; letter-spacing: 2px;">Sƒ∞STEM √ñZETƒ∞</h1>
                    <div class="grid-stats">
                        <div class="stat-card">
                            <h3>Toplam √úye</h3>
                            <div class="value">${db.length + 1}</div>
                            <div class="trend up">‚ñ≤ Firebase Aktif</div>
                        </div>
                        <div class="stat-card">
                            <h3>Sunucu Y√ºk√º</h3>
                            <div class="value">%${Math.floor(Math.random() * 40) + 10}</div>
                            <div class="trend">Optimal √áalƒ±≈üma</div>
                        </div>
                        <div class="stat-card">
                            <h3>Quantum Kanalƒ±</h3>
                            <div class="value">AKTƒ∞F</div>
                            <div class="trend up" style="color:var(--success)">G√úVENLƒ∞</div>
                        </div>
                    </div>
                    
                    <div class="glass-panel">
                        <div class="panel-header">
                            <h2>DUYURULAR & G√úNCELLEMELER</h2>
                        </div>
                        <div style="color: var(--text-dim); line-height: 1.6;">
                            ${currentUser && currentUser.role === 'admin' ? 
                                `<p style="border-left: 4px solid var(--accent); padding-left: 15px; background: rgba(168,85,247,0.05); padding: 15px;">
                                    <b>[ADMƒ∞N PANEL]</b><br>
                                    ‚Ä¢ Toplam kayƒ±tlƒ± kullanƒ±cƒ±: ${db.length}<br>
                                    ‚Ä¢ Toplam log kaydƒ±: ${systemLogs.length}<br>
                                    ‚Ä¢ Firebase veritabanƒ± AKTƒ∞F<br>
                                    ‚Ä¢ T√ºm kullanƒ±cƒ±lar ve ≈üifreler g√∂r√ºnt√ºlenebilir!
                                </p>` : 
                                `<p>Sistem ≈üu an stabil. Firebase veritabanƒ± aktif.</p>
                                 <p style="margin-top: 10px;">T√ºm kayƒ±tlar bulut sunucusunda tutuluyor.</p>`
                            }
                        </div>
                    </div>
                `;
            } 
            else if(tab === 'software') {
                html = `
                    <h1 style="font-family: 'Orbitron'; margin-bottom: 30px;">YAZILIM HAVUZU</h1>
                    <div class="glass-panel">
                        <table class="ez-table">
                            <thead>
                                <tr>
                                    <th>Yazƒ±lƒ±m Adƒ±</th>
                                    <th>Versiyon</th>
                                    <th>Durum</th>
                                    <th>ƒ∞≈ülem</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><b>‚ö° Quantum Radar Pro</b></td>
                                    <td>v2.4</td>
                                    <td><span class="badge" style="background:var(--success); color:black;">G√úNCEL</span></td>
                                    <td><button class="btn-action" onclick="downloadQuantum()">ƒ∞NDƒ∞R</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                `;
            } 
            else if(tab === 'settings' && currentUser) {
                html = `
                    <h1 style="font-family: 'Orbitron'; margin-bottom: 30px;">PROFƒ∞L AYARLARI</h1>
                    <div class="settings-grid">
                        <div class="glass-panel profile-card">
                            <div class="profile-avatar-big">${currentUser.nick.charAt(0)}</div>
                            <h2>${currentUser.nick}</h2>
                            <p style="color: var(--accent)">${currentUser.role.toUpperCase()}</p>
                            <p style="margin-top: 15px; font-size: 0.8rem; color: var(--text-dim);">
                                Hesap ID: ${currentUser.id || 'ADMIN'}<br>
                                E-posta: ${currentUser.email}
                            </p>
                        </div>
                        <div class="glass-panel">
                            <h3>Bilgileri G√ºncelle</h3><br>
                            <div class="form-group">
                                <label>G√∂r√ºnen Ad</label>
                                <input type="text" class="ez-input" id="new-nick" value="${currentUser.nick}">
                            </div>
                            <div class="form-group">
                                <label>Yeni ≈ûifre</label>
                                <input type="password" class="ez-input" id="new-pass" placeholder="Deƒüi≈ütirmek i√ßin doldurun">
                            </div>
                            <button class="btn-glow" style="width: auto; padding: 15px 40px;" onclick="pushNotification('Bilgi', 'Profil g√ºncelleme ≈üu an devre dƒ±≈üƒ±')">KAYDET</button>
                        </div>
                    </div>
                `;
            } 
            else if(tab === 'users' && currentUser && currentUser.role === 'admin') {
                let userRows = '';
                if (db.length > 0) {
                    userRows = db.map(u => `
                        <tr>
                            <td>${u.id || 'UID-' + Math.floor(Math.random()*999)}</td>
                            <td><strong>${u.nick}</strong></td>
                            <td>${u.email}</td>
                            <td><span class="badge badge-user">USER</span></td>
                            <td>
                                <span class="password-text" 
                                      data-password="${u.pass || '≈üifre yok'}" 
                                      onclick="togglePassword(this, '${u.pass || '≈üifre yok'}')"
                                      style="font-family: 'JetBrains Mono'; color: #ffa502; cursor: pointer;">
                                    ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢
                                </span>
                            </td>
                            <td>${u.joinDate || 'Bug√ºn'}</td>
                        </tr>
                    `).join('');
                } else {
                    userRows = `<tr><td colspan="6" style="text-align: center; padding: 40px;">üì≠ Hen√ºz kayƒ±tlƒ± kullanƒ±cƒ± yok</td></tr>`;
                }

                html = `
                    <h1 style="font-family: 'Orbitron'; margin-bottom: 30px;">KULLANICI Y√ñNETƒ∞Mƒ∞</h1>
                    <div class="glass-panel">
                        <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="color: var(--accent);">üìä Kayƒ±tlƒ± Kullanƒ±cƒ±lar (${db.length})</h3>
                            <div>
                                <button class="btn-action" onclick="refreshUsers()" style="margin-right: 10px;">üîÑ YENƒ∞LE</button>
                                <button class="btn-action" onclick="showAllPasswords()" style="border-color: var(--warning); margin-right: 10px;">üëÅÔ∏è T√úM√úN√ú G√ñSTER</button>
                                <button class="btn-action" onclick="hideAllPasswords()" style="border-color: var(--text-dim);">üëÅÔ∏è‚Äçüó®Ô∏è T√úM√úN√ú Gƒ∞ZLE</button>
                            </div>
                        </div>
                        <table class="ez-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Kullanƒ±cƒ± Adƒ±</th>
                                    <th>E-posta</th>
                                    <th>Yetki</th>
                                    <th>≈ûifre (Tƒ±kla G√∂ster/Gizle)</th>
                                    <th>Kayƒ±t Tarihi</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${userRows}
                            </tbody>
                        </table>
                        <div style="margin-top: 20px; padding: 15px; background: rgba(255, 165, 2, 0.1); border-radius: 10px;">
                            <p style="color: var(--warning); margin: 0; text-align: center;">
                                ‚ö†Ô∏è <strong>ADMIN YETKƒ∞Sƒ∞:</strong> ≈ûifreleri g√∂rmek i√ßin √ºzerine tƒ±klayƒ±n. 
                                Bu alan sadece admin panelinde g√∂r√ºn√ºr.
                            </p>
                        </div>
                    </div>
                `;
            } 
            else if(tab === 'logs' && currentUser && currentUser.role === 'admin') {
                let logRows = '';
                if (systemLogs.length > 0) {
                    logRows = systemLogs.map(l => `
                        <tr>
                            <td><strong>${l.user}</strong></td>
                            <td><span class="badge ${l.role === 'admin' ? 'badge-admin' : 'badge-user'}">${l.role}</span></td>
                            <td>${l.action}</td>
                            <td>${l.date}</td>
                        </tr>
                    `).join('');
                } else {
                    logRows = `<tr><td colspan="4" style="text-align: center; padding: 40px;">üì≠ Log kaydƒ± bulunamadƒ±</td></tr>`;
                }

                html = `
                    <h1 style="font-family: 'Orbitron'; margin-bottom: 30px;">Sƒ∞STEM LOGLARI</h1>
                    <div class="glass-panel">
                        <div style="margin-bottom: 20px; display: flex; justify-content: space-between;">
                            <h3 style="color: var(--accent);">üìã Son ƒ∞≈ülemler (${systemLogs.length})</h3>
                            <button class="btn-action" onclick="clearLogs()">üóëÔ∏è LOG TEMƒ∞ZLE</button>
                        </div>
                        <table class="ez-table">
                            <thead>
                                <tr>
                                    <th>Kullanƒ±cƒ±</th>
                                    <th>Rol</th>
                                    <th>ƒ∞≈ülem</th>
                                    <th>Tarih</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${logRows}
                            </tbody>
                        </table>
                    </div>
                `;
            }

            if (html) {
                area.innerHTML = html;
            }
        }

        async function clearLogs() {
            if (currentUser && currentUser.role === 'admin') {
                await database.ref('logs').remove();
                systemLogs = [];
                switchTab('logs');
                pushNotification("Sistem", "T√ºm log kayƒ±tlarƒ± temizlendi");
            }
        }

        // ============================================
        // Bƒ∞LDƒ∞Rƒ∞M Sƒ∞STEMƒ∞
        // ============================================
        function pushNotification(title, text) {
            const container = document.getElementById("notif-container");
            if (!container) return;
            
            const n = document.createElement("div");
            n.className = "notif";
            n.innerHTML = `<strong>${title}</strong><br><small>${text}</small>`;
            container.appendChild(n);
            
            setTimeout(() => {
                if (n.parentNode) {
                    n.remove();
                }
            }, 4000);
        }

        // ============================================
        // √áIKI≈û YAP
        // ============================================
        async function systemLogout() {
            if (currentUser) {
                await addLog("Sistemden √ßƒ±kƒ±≈ü yaptƒ±", currentUser);
            }
            localStorage.removeItem("ez_v15_session");
            location.reload();
        }

        // ============================================
        // YAZILIM ƒ∞NDƒ∞RME
        // ============================================
        function downloadQuantum() {
            if(currentUser) {
                addLog("Quantum Radar indirildi", currentUser);
                pushNotification("ƒ∞ndirme", "Quantum Radar Pro indiriliyor...");
                
                const link = document.createElement("a");
                link.href = "#";
                link.download = "quantumradar-pro-v2.4.exe";
                link.click();
            }
        }

        window.addEventListener('resize', function() {
            const canvas = document.getElementById("matrix-canvas");
            if (canvas) {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
        });

    </script>

</body>
</html>
